<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>八字算命系统</title>
    <style>
/* 全局样式 */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'KaiTi', 'STKaiti', 'Microsoft YaHei', serif;
    background: linear-gradient(to bottom, #0a0a0a 0%, #1a1620 30%, #2a2438 70%, #1f1a2e 100%);
    background-attachment: fixed;
    min-height: 100vh;
    padding: 20px;
    line-height: 1.8;
    position: relative;
    overflow-x: hidden;
    color: #f4e5c2; /* 古纸黄白色，提高对比度 */
}

/* 背景装饰 - 传统纹样 */
body::before {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-image:
        radial-gradient(circle at 20% 50%, rgba(218, 165, 32, 0.05) 0%, transparent 50%),
        radial-gradient(circle at 80% 80%, rgba(218, 165, 32, 0.05) 0%, transparent 50%),
        repeating-linear-gradient(
            45deg,
            transparent,
            transparent 10px,
            rgba(218, 165, 32, 0.01) 10px,
            rgba(218, 165, 32, 0.01) 20px
        );
    pointer-events: none;
    z-index: 0;
}

/* 增加传统纹理 */
body::after {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-image:
        url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><text x="10" y="50" font-size="80" fill="rgba(218,165,32,0.02)" font-family="serif">卦</text></svg>');
    background-size: 200px 200px;
    background-position: 0 0, 100px 100px;
    opacity: 0.5;
    pointer-events: none;
    z-index: 0;
}

.container {
    max-width: 1200px;
    margin: 0 auto;
    position: relative;
    z-index: 1;
}

/* 头部样式 - 大师风范 */
header {
    text-align: center;
    color: #d4af37; /* 皇家金色 */
    margin-bottom: 40px;
    padding: 40px 20px;
    position: relative;
    background: linear-gradient(135deg, rgba(139, 69, 19, 0.15) 0%, rgba(0, 0, 0, 0.05) 100%);
    border-radius: 8px;
    border: 1px solid rgba(212, 175, 55, 0.2);
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

/* 增加传统边框装饰 */
header::before {
    content: '';
    position: absolute;
    top: 5px;
    left: 5px;
    right: 5px;
    bottom: 5px;
    border: 1px solid rgba(212, 175, 55, 0.3);
    border-radius: 5px;
    pointer-events: none;
}

header::after {
    content: '☯';
    position: absolute;
    top: -10px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 2rem;
    opacity: 0.3;
    animation: rotate 20s linear infinite;
}

@keyframes rotate {
    from { transform: translateX(-50%) rotate(0deg); }
    to { transform: translateX(-50%) rotate(360deg); }
}

header h1 {
    font-size: 3.2rem;
    margin-bottom: 15px;
    text-shadow: 3px 3px 12px rgba(212, 175, 55, 0.6), 0 0 20px rgba(212, 175, 55, 0.3);
    letter-spacing: 6px;
    font-weight: bold;
    background: linear-gradient(135deg, #d4af37 0%, #ffd700 30%, #d4af37 60%, #b8860b 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.subtitle {
    font-size: 1.2rem;
    color: #d4af37;
    opacity: 0.95;
    letter-spacing: 4px;
    text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.5);
    font-weight: 500;
}

/* 卡片样式 - 传统宣纸质感 */
.card {
    background:
        linear-gradient(135deg, rgba(244, 229, 194, 0.95) 0%, rgba(238, 217, 173, 0.92) 50%, rgba(230, 205, 162, 0.9) 100%),
        repeating-linear-gradient(
            0deg,
            transparent,
            transparent 2px,
            rgba(139, 69, 19, 0.02) 2px,
            rgba(139, 69, 19, 0.02) 4px
        );
    border-radius: 8px;
    padding: 40px;
    box-shadow:
        0 15px 50px rgba(0,0,0,0.6),
        inset 0 1px 0 rgba(255,255,255,0.6),
        inset 0 -1px 0 rgba(0,0,0,0.1);
    margin-bottom: 35px;
    animation: fadeIn 0.8s ease-in;
    border: 2px solid rgba(139, 69, 19, 0.3);
    position: relative;
    color: #2c1810; /* 深褐色文字，增强可读性 */
}

@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* 表单样式 */
.input-section h2 {
    color: #8b4513;
    margin-bottom: 25px;
    font-size: 1.8rem;
    text-align: center;
    letter-spacing: 4px;
    position: relative;
    padding-bottom: 15px;
}

.input-section h2::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 50%;
    transform: translateX(-50%);
    width: 60px;
    height: 2px;
    background: linear-gradient(90deg, transparent, #daa520, transparent);
}

.form-group {
    margin-bottom: 20px;
}

.form-group label {
    display: block;
    margin-bottom: 8px;
    color: #5d4037;
    font-weight: 600;
    font-size: 1rem;
    letter-spacing: 1px;
}

.form-group input,
.form-group select {
    width: 100%;
    padding: 12px 15px;
    border: 2px solid #d7ccc8;
    border-radius: 6px;
    font-size: 1rem;
    transition: all 0.3s ease;
    background: #fdfbf7;
    color: #3e2723;
    font-family: 'Microsoft YaHei', sans-serif;
}

.form-group input[type="date"] {
    cursor: pointer;
}

.form-group input:focus,
.form-group select:focus {
    outline: none;
    border-color: #daa520;
    box-shadow: 0 0 0 3px rgba(218, 165, 32, 0.1);
    background: #fff;
}

/* 历法选择器样式 */
.calendar-type-selector {
    display: flex;
    gap: 20px;
    padding: 10px 0;
}

.radio-label {
    display: flex;
    align-items: center;
    cursor: pointer;
    padding: 8px 15px;
    border: 2px solid #d7ccc8;
    border-radius: 6px;
    background: #fdfbf7;
    transition: all 0.3s ease;
}

.radio-label:hover {
    border-color: #daa520;
    background: #fff;
}

.radio-label input[type="radio"] {
    width: auto;
    margin-right: 8px;
    cursor: pointer;
    accent-color: #daa520;
}

.radio-label input[type="radio"]:checked + span {
    color: #8b4513;
    font-weight: 600;
}

.radio-label span {
    color: #5d4037;
    transition: all 0.3s ease;
}

/* 复选框样式 */
.form-group input[type="checkbox"] {
    width: auto;
    margin-right: 8px;
    cursor: pointer;
    accent-color: #daa520;
}

.form-group label {
    display: flex;
    align-items: center;
}

/* 日期提示文字 */
.date-hint {
    display: block;
    margin-top: 5px;
    font-size: 0.85rem;
    color: #8b6914;
    font-style: italic;
}

/* 按钮样式 */
.btn-primary,
.btn-secondary {
    width: 100%;
    padding: 15px;
    border: none;
    border-radius: 6px;
    font-size: 1.1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    margin-top: 10px;
    letter-spacing: 3px;
}

.btn-primary {
    background: linear-gradient(135deg, #8b4513 0%, #a0522d 100%);
    color: #ffd700;
    box-shadow: 0 4px 15px rgba(139, 69, 19, 0.3);
    border: 1px solid #daa520;
}

.btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(218, 165, 32, 0.5);
    background: linear-gradient(135deg, #a0522d 0%, #8b4513 100%);
}

.btn-secondary {
    background: linear-gradient(135deg, #f5f1e8 0%, #e8dcc8 100%);
    color: #8b4513;
    border: 2px solid #d7ccc8;
}

.btn-secondary:hover {
    background: linear-gradient(135deg, #e8dcc8 0%, #f5f1e8 100%);
    border-color: #daa520;
}

/* 结果区域样式 */
.results {
    animation: fadeIn 0.6s ease-in;
}

.result-section h2 {
    color: #8b4513;
    margin-bottom: 20px;
    font-size: 1.6rem;
    border-bottom: none;
    padding-bottom: 15px;
    text-align: center;
    letter-spacing: 4px;
    position: relative;
}

.result-section h2::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 50%;
    transform: translateX(-50%);
    width: 80px;
    height: 2px;
    background: linear-gradient(90deg, transparent, #daa520, transparent);
}

/* 八字展示 - 传统竹简风格 */
.bazi-display {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 20px;
    margin-bottom: 20px;
}

.bazi-pillar {
    text-align: center;
    background: linear-gradient(180deg, #d4a574 0%, #c19a6b 100%);
    padding: 25px 15px;
    border-radius: 8px;
    box-shadow:
        0 5px 15px rgba(0,0,0,0.3),
        inset 0 1px 0 rgba(255,255,255,0.3);
    border: 2px solid #8b6914;
    position: relative;
}

.bazi-pillar::before {
    content: '';
    position: absolute;
    top: 5px;
    left: 5px;
    right: 5px;
    bottom: 5px;
    border: 1px solid rgba(139, 69, 19, 0.2);
    border-radius: 6px;
}

.pillar-label {
    font-size: 0.9rem;
    color: #5d4037;
    margin-bottom: 12px;
    letter-spacing: 2px;
    font-weight: 600;
}

.pillar-value {
    font-size: 2.2rem;
    font-weight: bold;
    color: #3e2723;
    letter-spacing: 8px;
    text-shadow: 1px 1px 2px rgba(255,255,255,0.5);
    font-family: 'KaiTi', 'STKaiti', serif;
}

.bazi-details {
    background: linear-gradient(135deg, #fdfbf7 0%, #f5f1e8 100%);
    padding: 20px;
    border-radius: 8px;
    border-left: 4px solid #daa520;
    color: #5d4037;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

/* 五行图表 - 传统五行色 */
.wuxing-chart {
    display: grid;
    grid-template-columns: repeat(5, 1fr);
    gap: 15px;
    margin-bottom: 20px;
}

.wuxing-item {
    text-align: center;
    padding: 20px 10px;
    border-radius: 8px;
    color: white;
    font-weight: 600;
    box-shadow:
        0 4px 12px rgba(0,0,0,0.3),
        inset 0 1px 0 rgba(255,255,255,0.2);
    border: 2px solid rgba(255,255,255,0.1);
}

.wuxing-item.wood {
    background: linear-gradient(135deg, #2d5016 0%, #3d6b1f 100%);
}

.wuxing-item.fire {
    background: linear-gradient(135deg, #b71c1c 0%, #d32f2f 100%);
}

.wuxing-item.earth {
    background: linear-gradient(135deg, #8b6914 0%, #b8860b 100%);
}

.wuxing-item.metal {
    background: linear-gradient(135deg, #616161 0%, #9e9e9e 100%);
}

.wuxing-item.water {
    background: linear-gradient(135deg, #01579b 0%, #0277bd 100%);
}

.wuxing-name {
    font-size: 1.2rem;
    margin-bottom: 10px;
    letter-spacing: 2px;
}

.wuxing-count {
    font-size: 2rem;
    font-weight: bold;
}

.wuxing-bar {
    height: 8px;
    background: rgba(255,255,255,0.2);
    border-radius: 4px;
    margin-top: 10px;
    overflow: hidden;
}

.wuxing-bar-fill {
    height: 100%;
    background: rgba(255,255,255,0.8);
    transition: width 0.5s ease;
}

.wuxing-analysis {
    background: linear-gradient(135deg, #fdfbf7 0%, #f5f1e8 100%);
    padding: 20px;
    border-radius: 8px;
    border-left: 4px solid #daa520;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.wuxing-analysis h3 {
    color: #8b4513;
    margin-bottom: 10px;
    letter-spacing: 2px;
}

.wuxing-analysis p {
    color: #5d4037;
    line-height: 1.8;
}

/* 大运列表 */
.dayun-list {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
}

.dayun-item {
    background: linear-gradient(135deg, #fdfbf7 0%, #f5f1e8 100%);
    padding: 20px;
    border-radius: 8px;
    border-left: 4px solid #daa520;
    box-shadow: 0 3px 10px rgba(0,0,0,0.2);
    transition: all 0.3s ease;
}

.dayun-item:hover {
    transform: translateY(-3px);
    box-shadow: 0 5px 15px rgba(218, 165, 32, 0.3);
}

.dayun-item h3 {
    color: #8b4513;
    margin-bottom: 10px;
    font-size: 1.2rem;
    letter-spacing: 2px;
}

.dayun-pillar {
    font-size: 1.8rem;
    font-weight: bold;
    color: #5d4037;
    margin-bottom: 10px;
    letter-spacing: 4px;
    font-family: 'KaiTi', 'STKaiti', serif;
}

.dayun-age {
    color: #8b6914;
    font-size: 0.9rem;
    margin-bottom: 10px;
}

.dayun-desc {
    color: #5d4037;
    font-size: 0.95rem;
    line-height: 1.6;
}

/* 流年列表 */
.liunian-list {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 15px;
}

.liunian-item {
    background: linear-gradient(135deg, #fdfbf7 0%, #f5f1e8 100%);
    padding: 15px;
    border-radius: 8px;
    text-align: center;
    box-shadow: 0 3px 10px rgba(0,0,0,0.2);
    border: 2px solid transparent;
    transition: all 0.3s ease;
}

.liunian-item:hover {
    border-color: #daa520;
    transform: scale(1.05);
}

.liunian-year {
    color: #8b4513;
    font-weight: bold;
    margin-bottom: 8px;
    font-size: 1.1rem;
}

.liunian-pillar {
    font-size: 1.5rem;
    font-weight: bold;
    color: #5d4037;
    margin-bottom: 8px;
    letter-spacing: 3px;
    font-family: 'KaiTi', 'STKaiti', serif;
}

.liunian-desc {
    color: #8b6914;
    font-size: 0.85rem;
}

/* 命理分析 */
.mingli-content {
    display: grid;
    gap: 20px;
}

.analysis-item {
    background: linear-gradient(135deg, #fdfbf7 0%, #f5f1e8 100%);
    padding: 25px;
    border-radius: 8px;
    border-left: 4px solid #daa520;
    box-shadow: 0 3px 10px rgba(0,0,0,0.2);
    position: relative;
}

.analysis-item::before {
    content: '◆';
    position: absolute;
    top: 25px;
    left: -12px;
    color: #daa520;
    font-size: 1.2rem;
    background: #fdfbf7;
}

.analysis-item h3 {
    color: #8b4513;
    margin-bottom: 12px;
    font-size: 1.3rem;
    letter-spacing: 3px;
}

.analysis-item p {
    color: #5d4037;
    line-height: 1.8;
    font-size: 1rem;
}

/* 命理分析格式化显示样式 */
.analysis-content {
    line-height: 1.8;
    color: #3d2817;
    font-weight: 500;
}

.analysis-paragraph {
    margin-bottom: 12px;
}

.analysis-section-title {
    color: #8b4513;
    font-weight: bold;
    font-size: 1.1rem;
    margin: 20px 0 10px 0;
    padding: 8px 0;
    border-bottom: 2px solid rgba(212, 175, 55, 0.3);
    background: linear-gradient(90deg, rgba(212, 175, 55, 0.1) 0%, transparent 100%);
    border-radius: 0 4px 4px 0;
}

/* 页脚 */
footer {
    text-align: center;
    color: #daa520;
    padding: 30px 20px;
    opacity: 0.9;
    margin-top: 40px;
    letter-spacing: 2px;
    font-size: 0.95rem;
}

/* 高级命理分析样式 - 大师手笔 */
.advanced-analysis {
    display: flex;
    flex-direction: column;
    gap: 30px;
}

.analysis-item.advanced {
    background: linear-gradient(135deg,
        rgba(244, 229, 194, 0.95) 0%,
        rgba(238, 217, 173, 0.92) 50%,
        rgba(230, 205, 162, 0.9) 100%);
    border: 2px solid rgba(139, 69, 19, 0.4);
    border-radius: 10px;
    padding: 30px;
    position: relative;
    overflow: hidden;
    box-shadow:
        0 10px 30px rgba(0,0,0,0.4),
        inset 0 1px 0 rgba(255,255,255,0.4),
        inset 0 -1px 0 rgba(0,0,0,0.1);
    color: #2c1810;
}

.analysis-item.advanced::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(90deg,
        transparent 0%,
        rgba(139, 69, 19, 0.3) 20%,
        rgba(212, 175, 55, 0.6) 50%,
        rgba(139, 69, 19, 0.3) 80%,
        transparent 100%);
    animation: shimmer 4s ease-in-out infinite;
}

@keyframes shimmer {
    0% { transform: translateX(-100%); }
    100% { transform: translateX(100%); }
}

.advanced-content {
    line-height: 1.9;
    color: #2c1810;
    font-size: 1.05rem;
}

/* 新的排版结构样式 */
.analysis-title {
    color: #8b4513;
    margin: 0 0 25px 0;
    font-size: 1.4rem;
    font-weight: bold;
    border-left: 5px solid #d4af37;
    padding-left: 20px;
    background: linear-gradient(90deg, rgba(212, 175, 55, 0.15) 0%, transparent 100%);
    padding: 12px 20px;
    border-radius: 0 8px 8px 0;
    box-shadow: 0 2px 8px rgba(139, 69, 19, 0.1);
}

.section-subtitle {
    color: #a0522d;
    margin: 20px 0 10px 0;
    font-size: 1.1rem;
    font-weight: bold;
    border-bottom: 2px solid rgba(212, 175, 55, 0.3);
    padding-bottom: 5px;
}

.analysis-section {
    margin: 20px 0;
    padding: 15px;
    background: rgba(244, 229, 194, 0.3);
    border-radius: 8px;
    border-left: 3px solid #d4af37;
}

.analysis-text {
    margin: 10px 0;
    text-align: justify;
    color: #3d2817;
    font-weight: 500;
    line-height: 1.8;
}

/* 用神分析特殊样式 */
.yongshen-container {
    display: flex;
    flex-direction: column;
    gap: 20px;
}

.yongshen-results {
    display: flex;
    flex-direction: column;
    gap: 15px;
    margin: 20px 0;
}

.yongshen-item {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 12px 15px;
    background: linear-gradient(135deg, rgba(244, 229, 194, 0.6) 0%, rgba(238, 217, 173, 0.5) 100%);
    border-radius: 6px;
    border: 1px solid rgba(139, 69, 19, 0.2);
}

.yongshen-label {
    color: #8b4513;
    font-weight: bold;
    font-size: 1.1rem;
    min-width: 80px;
}

.yongshen-primary {
    color: #8b4513;
    font-weight: bold;
    font-size: 1.2rem;
    text-shadow: 1px 1px 2px rgba(139, 69, 19, 0.2);
    background: linear-gradient(135deg, rgba(212, 175, 55, 0.3) 0%, rgba(212, 175, 55, 0.1) 100%);
    padding: 8px 15px;
    border-radius: 6px;
    border-left: 3px solid #d4af37;
    border: 2px solid rgba(212, 175, 55, 0.4);
    box-shadow: 0 2px 6px rgba(139, 69, 19, 0.15);
}

.yongshen-secondary {
    color: #a0522d;
    font-weight: bold;
    font-size: 1.1rem;
    background: rgba(212, 175, 55, 0.2);
    padding: 6px 12px;
    border-radius: 4px;
    border: 1px solid rgba(212, 175, 55, 0.3);
    box-shadow: 0 1px 4px rgba(139, 69, 19, 0.1);
}

/* 格局分析新样式 */
.geju-container {
    display: flex;
    flex-direction: column;
    gap: 20px;
}

.geju-results {
    display: flex;
    flex-direction: column;
    gap: 20px;
}

.geju-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
    padding-bottom: 10px;
    border-bottom: 2px solid rgba(212, 175, 55, 0.3);
}

.geju-name {
    color: #8b4513;
    font-size: 1.2rem;
    font-weight: bold;
    margin: 0;
}

.geju-details {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.geju-detail-item {
    display: flex;
    gap: 10px;
    align-items: flex-start;
}

.detail-label {
    color: #8b4513;
    font-weight: bold;
    min-width: 90px;
    font-size: 1rem;
}

.detail-text {
    color: #3d2817;
    font-weight: 500;
    flex: 1;
    line-height: 1.6;
}

.geju-strength {
    color: #d4af37;
    font-weight: bold;
    font-size: 1.1rem;
    background: rgba(212, 175, 55, 0.2);
    padding: 4px 10px;
    border-radius: 4px;
}

.geju-special {
    padding: 20px;
    background: linear-gradient(135deg, rgba(244, 229, 194, 0.7) 0%, rgba(238, 217, 173, 0.6) 100%);
    border-radius: 8px;
    border: 2px solid rgba(139, 69, 19, 0.3);
    text-align: center;
}

.special-text {
    color: #3d2817;
    font-weight: 500;
    font-size: 1.05rem;
    line-height: 1.7;
    margin: 0;
}

/* 神煞分析新样式 */
.shensha-container {
    display: flex;
    flex-direction: column;
    gap: 25px;
}

.shensha-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 20px;
    margin: 20px 0;
}

.shensha-item {
    padding: 20px;
    border-radius: 10px;
    border: 2px solid rgba(139, 69, 19, 0.3);
    transition: all 0.3s ease;
    background: linear-gradient(135deg, rgba(244, 229, 194, 0.9) 0%, rgba(238, 217, 173, 0.85) 100%);
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
}

.shensha-item.auspicious {
    border-color: rgba(34, 139, 34, 0.4);
    background: linear-gradient(135deg, rgba(230, 244, 224, 0.9) 0%, rgba(217, 238, 206, 0.85) 100%);
}

.shensha-item.neutral {
    border-color: rgba(255, 165, 0, 0.4);
    background: linear-gradient(135deg, rgba(255, 248, 224, 0.9) 0%, rgba(255, 238, 173, 0.85) 100%);
}

.shensha-item.inauspicious {
    border-color: rgba(220, 20, 60, 0.4);
    background: linear-gradient(135deg, rgba(244, 224, 224, 0.9) 0%, rgba(238, 206, 206, 0.85) 100%);
}

.shensha-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
    padding-bottom: 10px;
    border-bottom: 1px solid rgba(139, 69, 19, 0.2);
}

.shensha-name {
    font-size: 1.2rem;
    font-weight: bold;
    margin: 0;
}

.shensha-item.auspicious .shensha-name { color: #2d5016; }
.shensha-item.neutral .shensha-name { color: #b8860b; }
.shensha-item.inauspicious .shensha-name { color: #8b1a1a; }

.shensha-type {
    font-size: 0.9rem;
    font-weight: 500;
    padding: 4px 8px;
    border-radius: 4px;
    background: rgba(212, 175, 55, 0.2);
    color: #8b4513;
}

.shensha-content {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.shensha-description {
    color: #3d2817;
    font-weight: 500;
    line-height: 1.6;
    margin: 0;
}

.shensha-effect {
    color: #5d4037;
    font-weight: 500;
    font-style: italic;
    margin: 0;
    padding-top: 8px;
    border-top: 1px dashed rgba(139, 69, 19, 0.2);
}

.shensha-empty {
    padding: 25px;
    background: linear-gradient(135deg, rgba(244, 229, 194, 0.8) 0%, rgba(238, 217, 173, 0.7) 100%);
    border-radius: 10px;
    border: 2px solid rgba(139, 69, 19, 0.3);
    text-align: center;
}

.empty-text {
    color: #3d2817;
    font-weight: 500;
    font-size: 1.05rem;
    line-height: 1.7;
    margin: 0;
}

/* 理论依据样式 */
.theory-reference {
    margin-top: 25px;
    padding: 20px;
    background: linear-gradient(135deg, rgba(212, 175, 55, 0.1) 0%, rgba(184, 134, 11, 0.05) 100%);
    border-radius: 8px;
    border: 1px solid rgba(212, 175, 55, 0.3);
}

.theory-title {
    color: #8b4513;
    font-size: 1rem;
    font-weight: bold;
    margin: 0 0 10px 0;
    padding-bottom: 8px;
    border-bottom: 1px solid rgba(212, 175, 55, 0.3);
}

.theory-text {
    color: #5d4037;
    font-weight: 500;
    font-size: 0.95rem;
    line-height: 1.7;
    margin: 0;
    font-style: italic;
}

/* 传统印章 */
.master-seal {
    position: fixed;
    bottom: 20px;
    right: 20px;
    width: 80px;
    height: 80px;
    background: linear-gradient(135deg, #dc143c 0%, #8b0000 100%);
    border-radius: 5px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #ffffff;
    font-size: 24px;
    font-weight: bold;
    box-shadow: 0 4px 15px rgba(220, 20, 60, 0.4);
    opacity: 0.8;
    transform: rotate(-5deg);
    z-index: 1000;
    pointer-events: none;
    font-family: 'KaiTi', 'STKaiti', serif;
    border: 2px solid #8b0000;
}

.master-seal::before {
    content: '大师';
    position: absolute;
    top: 8px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 14px;
}

.master-seal::after {
    content: '手笔';
    position: absolute;
    bottom: 8px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 14px;
}

/* 响应式设计 */
@media (max-width: 768px) {
    header h1 {
        font-size: 2rem;
    }

    .bazi-display {
        grid-template-columns: repeat(2, 1fr);
    }

    .wuxing-chart {
        grid-template-columns: repeat(2, 1fr);
    }

    .dayun-list,
    .liunian-list {
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
    }

    .card {
        padding: 20px;
    }

    .pillar-value {
        font-size: 1.5rem;
    }
}

@media (max-width: 480px) {
    body {
        padding: 10px;
    }

    header h1 {
        font-size: 1.5rem;
    }

    .subtitle {
        font-size: 0.9rem;
    }

    .bazi-display {
        grid-template-columns: 1fr;
        gap: 10px;
    }

    .wuxing-chart {
        grid-template-columns: 1fr;
    }

    .card {
        padding: 15px;
    }
}
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>八字算命系统</h1>
            <p class="subtitle">传承千年智慧，点亮人生航灯</p>
            <div style="margin-top: 20px; text-align: center; color: rgba(212, 175, 55, 0.9); font-size: 1rem; line-height: 1.6; max-width: 600px; margin-left: auto; margin-right: auto;">
                <p style="margin: 10px 0;">融合传统中华命理学精髓与现代网页技术</p>
                <p style="margin: 10px 0;">为您呈现专业、准确、美观的命理分析服务</p>
            </div>
        </header>

        <div class="content">
            <!-- 输入表单 -->
            <section class="input-section card">
                <h2>出生信息</h2>
                <form id="birthdayForm">
                    <div class="form-group">
                        <label for="name">姓名 (选填)</label>
                        <input type="text" id="name" name="name" placeholder="请输入姓名，将结合姓名五行分析">
                    </div>

                    <div class="form-group">
                        <label>历法选择</label>
                        <div class="calendar-type-selector">
                            <label class="radio-label">
                                <input type="radio" name="calendarType" value="solar" checked>
                                <span>阳历（公历）</span>
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="calendarType" value="lunar">
                                <span>农历（阴历）</span>
                            </label>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="birthdate">出生日期</label>
                        <input type="date" id="birthdate" name="birthdate" required>
                        <small class="date-hint">请选择出生日期（阳历或农历）</small>
                    </div>

                    <div class="form-group" id="leapMonthGroup" style="display: none;">
                        <label>
                            <input type="checkbox" id="isLeapMonth" name="isLeapMonth">
                            <span>闰月</span>
                        </label>
                        <small class="date-hint">如果是农历闰月出生，请勾选</small>
                    </div>

                    <div class="form-group">
                        <label for="hour">出生时辰</label>
                        <select id="hour" name="hour" required>
                            <option value="">请选择时辰</option>
                            <option value="0">子时 (23:00-00:59)</option>
                            <option value="1">丑时 (01:00-02:59)</option>
                            <option value="2">寅时 (03:00-04:59)</option>
                            <option value="3">卯时 (05:00-06:59)</option>
                            <option value="4">辰时 (07:00-08:59)</option>
                            <option value="5">巳时 (09:00-10:59)</option>
                            <option value="6">午时 (11:00-12:59)</option>
                            <option value="7">未时 (13:00-14:59)</option>
                            <option value="8">申时 (15:00-16:59)</option>
                            <option value="9">酉时 (17:00-18:59)</option>
                            <option value="10">戌时 (19:00-20:59)</option>
                            <option value="11">亥时 (21:00-22:59)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="gender">性别</label>
                        <select id="gender" name="gender" required>
                            <option value="">请选择性别</option>
                            <option value="male">男</option>
                            <option value="female">女</option>
                        </select>
                    </div>

                    <button type="submit" class="btn-primary">开始算命</button>
                </form>
            </section>

            <!-- 结果展示区域 -->
            <div id="results" class="results" style="display: none;">
                <!-- 八字展示 -->
                <section class="result-section card">
                    <h2>您的八字</h2>
                    <div class="bazi-display">
                        <div class="bazi-pillar">
                            <div class="pillar-label">年柱</div>
                            <div class="pillar-value" id="yearPillar"></div>
                        </div>
                        <div class="bazi-pillar">
                            <div class="pillar-label">月柱</div>
                            <div class="pillar-value" id="monthPillar"></div>
                        </div>
                        <div class="bazi-pillar">
                            <div class="pillar-label">日柱</div>
                            <div class="pillar-value" id="dayPillar"></div>
                        </div>
                        <div class="bazi-pillar">
                            <div class="pillar-label">时柱</div>
                            <div class="pillar-value" id="hourPillar"></div>
                        </div>
                    </div>
                    <div class="bazi-details" id="baziDetails"></div>
                </section>

                <!-- 五行分析 -->
                <section class="result-section card">
                    <h2>五行分析</h2>
                    <div class="wuxing-chart" id="wuxingChart"></div>
                    <div class="wuxing-analysis" id="wuxingAnalysis"></div>
                </section>

                <!-- 高级命理分析 -->
                <section class="result-section card">
                    <h2>高级命理分析</h2>
                    <div class="advanced-analysis">
                        <!-- 用神分析 -->
                        <div class="analysis-item advanced">
                            <h3>用神分析</h3>
                            <div id="yongshenAnalysis" class="advanced-content"></div>
                        </div>

                        <!-- 格局分析 -->
                        <div class="analysis-item advanced">
                            <h3>格局分析</h3>
                            <div id="gejuAnalysis" class="advanced-content"></div>
                        </div>

                        <!-- 神煞分析 -->
                        <div class="analysis-item advanced">
                            <h3>神煞分析</h3>
                            <div id="shenshaAnalysis" class="advanced-content"></div>
                        </div>
                    </div>
                </section>

                <!-- 姓名五行分析 (如果填写了姓名) -->
                <section class="result-section card" id="nameAnalysisSection" style="display: none;">
                    <h2>姓名分析</h2>
                    <div id="nameAnalysis"></div>
                </section>

                <!-- 大运分析 -->
                <section class="result-section card">
                    <h2>大运分析</h2>
                    <div class="dayun-list" id="dayunList"></div>
                </section>

                <!-- 流年分析 -->
                <section class="result-section card">
                    <h2>近期流年</h2>
                    <div class="liunian-list" id="liunianList"></div>
                </section>

                <!-- 命理分析 -->
                <section class="result-section card">
                    <h2>命理分析</h2>
                    <div class="mingli-content">
                        <div class="analysis-item">
                            <h3>性格特点</h3>
                            <p id="personalityAnalysis"></p>
                        </div>
                        <div class="analysis-item">
                            <h3>事业运势</h3>
                            <p id="careerAnalysis"></p>
                        </div>
                        <div class="analysis-item">
                            <h3>财运分析</h3>
                            <p id="wealthAnalysis"></p>
                        </div>
                        <div class="analysis-item">
                            <h3>婚姻感情</h3>
                            <p id="marriageAnalysis"></p>
                        </div>
                        <div class="analysis-item">
                            <h3>健康运势</h3>
                            <p id="healthAnalysis"></p>
                        </div>
                    </div>
                </section>

                <!-- 重新计算按钮 -->
                <button class="btn-secondary" onclick="resetForm()">重新计算</button>
            </div>
        </div>

        <footer>
            <p>仅供娱乐参考，不构成专业命理建议</p>
        </footer>
    </div>

    <!-- 大师印章 -->
    <div class="master-seal" style="display: none;" id="masterSeal">
        卦
    </div>

    <script>
// 天干地支数据
const TIANGAN = ['甲', '乙', '丙', '丁', '戊', '己', '庚', '辛', '壬', '癸'];
const DIZHI = ['子', '丑', '寅', '卯', '辰', '巳', '午', '未', '申', '酉', '戌', '亥'];
const SHICHEN = ['子', '丑', '寅', '卯', '辰', '巳', '午', '未', '申', '酉', '戌', '亥'];

// 农历数据表 (1900-2100年)
const LUNAR_INFO = [
    0x04bd8,0x04ae0,0x0a570,0x054d5,0x0d260,0x0d950,0x16554,0x056a0,0x09ad0,0x055d2, // 1900-1909
    0x04ae0,0x0a5b6,0x0a4d0,0x0d250,0x1d255,0x0b540,0x0d6a0,0x0ada2,0x095b0,0x14977, // 1910-1919
    0x04970,0x0a4b0,0x0b4b5,0x06a50,0x06d40,0x1ab54,0x02b60,0x09570,0x052f2,0x04970, // 1920-1929
    0x06566,0x0d4a0,0x0ea50,0x06e95,0x05ad0,0x02b60,0x186e3,0x092e0,0x1c8d7,0x0c950, // 1930-1939
    0x0d4a0,0x1d8a6,0x0b550,0x056a0,0x1a5b4,0x025d0,0x092d0,0x0d2b2,0x0a950,0x0b557, // 1940-1949
    0x06ca0,0x0b550,0x15355,0x04da0,0x0a5b0,0x14573,0x052b0,0x0a9a8,0x0e950,0x06aa0, // 1950-1959
    0x0aea6,0x0ab50,0x04b60,0x0aae4,0x0a570,0x05260,0x0f263,0x0d950,0x05b57,0x056a0, // 1960-1969
    0x096d0,0x04dd5,0x04ad0,0x0a4d0,0x0d4d4,0x0d250,0x0d558,0x0b540,0x0b6a0,0x195a6, // 1970-1979
    0x095b0,0x049b0,0x0a974,0x0a4b0,0x0b27a,0x06a50,0x06d40,0x0af46,0x0ab60,0x09570, // 1980-1989
    0x04af5,0x04970,0x064b0,0x074a3,0x0ea50,0x06b58,0x055c0,0x0ab60,0x096d5,0x092e0, // 1990-1999
    0x0c960,0x0d954,0x0d4a0,0x0da50,0x07552,0x056a0,0x0abb7,0x025d0,0x092d0,0x0cab5, // 2000-2009
    0x0a950,0x0b4a0,0x0baa4,0x0ad50,0x055d9,0x04ba0,0x0a5b0,0x15176,0x052b0,0x0a930, // 2010-2019
    0x07954,0x06aa0,0x0ad50,0x05b52,0x04b60,0x0a6e6,0x0a4e0,0x0d260,0x0ea65,0x0d530, // 2020-2029
    0x05aa0,0x076a3,0x096d0,0x04afb,0x04ad0,0x0a4d0,0x1d0b6,0x0d250,0x0d520,0x0dd45, // 2030-2039
    0x0b5a0,0x056d0,0x055b2,0x049b0,0x0a577,0x0a4b0,0x0aa50,0x1b255,0x06d20,0x0ada0, // 2040-2049
    0x14b63,0x09370,0x049f8,0x04970,0x064b0,0x168a6,0x0ea50,0x06b20,0x1a6c4,0x0aae0, // 2050-2059
    0x0a2e0,0x0d2e3,0x0c960,0x0d557,0x0d4a0,0x0da50,0x05d55,0x056a0,0x0a6d0,0x055d4, // 2060-2069
    0x052d0,0x0a9b8,0x0a950,0x0b4a0,0x0b6a6,0x0ad50,0x055a0,0x0aba4,0x0a5b0,0x052b0, // 2070-2079
    0x0b273,0x06930,0x07337,0x06aa0,0x0ad50,0x14b55,0x04b60,0x0a570,0x054e4,0x0d160, // 2080-2089
    0x0e968,0x0d520,0x0daa0,0x16aa6,0x056d0,0x04ae0,0x0a9d4,0x0a2d0,0x0d150,0x0f252, // 2090-2099
    0x0d520 // 2100
];

// 农历转阳历
function lunar2solar(year, month, day, isLeapMonth = false) {
    if (year < 1900 || year > 2100) {
        return null;
    }

    const leapMonth = getLeapMonth(year);
    let isLeap = false;

    // 如果用户选择的是闰月
    if (isLeapMonth && month === leapMonth) {
        isLeap = true;
    }

    // 计算从1900年1月31日(农历1900年正月初一)到指定日期的天数
    let offset = 0;

    // 累加1900年到指定年份之前的天数
    for (let i = 1900; i < year; i++) {
        offset += yearDays(i);
    }

    // 累加当年指定月份之前的天数
    let leapMonthFlag = false;
    for (let i = 1; i < month; i++) {
        offset += monthDays(year, i);
        if (i === leapMonth) {
            leapMonthFlag = true;
        }
    }

    // 如果是闰月，加上闰月之前的天数
    if (isLeap) {
        offset += monthDays(year, month);
    }

    // 加上指定日期的天数
    offset += day - 1;

    // 1900年1月31日对应的Date对象
    const baseDate = new Date(1900, 0, 31);
    const targetDate = new Date(baseDate.getTime() + offset * 86400000);

    return {
        year: targetDate.getFullYear(),
        month: targetDate.getMonth() + 1,
        day: targetDate.getDate()
    };
}

// 获取农历某年的总天数
function yearDays(year) {
    let sum = 348; // 12个月 * 29天
    for (let i = 0x8000; i > 0x8; i >>= 1) {
        sum += (LUNAR_INFO[year - 1900] & i) ? 1 : 0;
    }
    return sum + leapDays(year);
}

// 获取农历某年闰月的天数
function leapDays(year) {
    if (getLeapMonth(year)) {
        return (LUNAR_INFO[year - 1900] & 0x10000) ? 30 : 29;
    }
    return 0;
}

// 获取农历某年的闰月月份，无闰月返回0
function getLeapMonth(year) {
    return LUNAR_INFO[year - 1900] & 0xf;
}

// 获取农历某年某月的天数
function monthDays(year, month) {
    if (month > 12 || month < 1) return -1;
    return (LUNAR_INFO[year - 1900] & (0x10000 >> month)) ? 30 : 29;
}

// 天干五行
const TIANGAN_WUXING = {
    '甲': '木', '乙': '木',
    '丙': '火', '丁': '火',
    '戊': '土', '己': '土',
    '庚': '金', '辛': '金',
    '壬': '水', '癸': '水'
};

// 地支五行
const DIZHI_WUXING = {
    '子': '水', '亥': '水',
    '寅': '木', '卯': '木',
    '巳': '火', '午': '火',
    '申': '金', '酉': '金',
    '丑': '土', '辰': '土', '未': '土', '戌': '土'
};

// 五行相生相克
const WUXING_SHENGKE = {
    '木': { sheng: '火', ke: '土', shengBy: '水', keBy: '金' },
    '火': { sheng: '土', ke: '金', shengBy: '木', keBy: '水' },
    '土': { sheng: '金', ke: '水', shengBy: '火', keBy: '木' },
    '金': { sheng: '水', ke: '木', shengBy: '土', keBy: '火' },
    '水': { sheng: '木', ke: '火', shengBy: '金', keBy: '土' }
};

// 神煞系统
const SHENSHA_SYSTEM = {
    tianyiGuiren: {
        '甲': ['丑', '未'],
        '戊': ['丑', '未'],
        '庚': ['丑', '未'],
        '乙': ['子', '申'],
        '己': ['子', '申'],
        '丙': ['亥', '酉'],
        '丁': ['亥', '酉'],
        '壬': ['卯', '巳'],
        '癸': ['卯', '巳'],
        '辛': ['寅', '午']
    },
    xianchi: {
        '寅': ['卯'], '午': ['卯'], '戌': ['卯'],
        '申': ['酉'], '子': ['酉'], '辰': ['酉'],
        '巳': ['午'], '酉': ['午'], '丑': ['午'],
        '亥': ['子'], '卯': ['子'], '未': ['子']
    },
    wenchang: {
        '甲': ['巳'], '乙': ['午'],
        '丙': ['申'], '丁': ['酉'],
        '戊': ['申'], '己': ['酉'],
        '庚': ['亥'], '辛': ['亥'],
        '壬': ['寅'], '癸': ['寅']
    },
    yangren: {
        '甲': ['卯'], '乙': ['辰'],
        '丙': ['午'], '丁': ['未'],
        '戊': ['午'], '己': ['未'],
        '庚': ['酉'], '辛': ['戌'],
        '壬': ['子'], '癸': ['丑']
    }
};

// 分析神煞
function analyzeShenSha(bazi) {
    const shenSha = [];
    const allDizhi = [bazi.year.dizhi, bazi.month.dizhi, bazi.day.dizhi, bazi.hour.dizhi];
    const allTiangan = [bazi.year.tiangan, bazi.month.tiangan, bazi.day.tiangan, bazi.hour.tiangan];

    // 检查天乙贵人
    for (let i = 0; i < allTiangan.length; i++) {
        const tg = allTiangan[i];
        if (SHENSHA_SYSTEM.tianyiGuiren[tg]) {
            for (const guiren of SHENSHA_SYSTEM.tianyiGuiren[tg]) {
                if (allDizhi.includes(guiren)) {
                    shenSha.push({
                        type: '贵人',
                        name: '天乙贵人',
                        location: guiren,
                        description: '天乙贵人是最吉利的神煞，主得贵人相助，逢凶化吉',
                        effect: '得贵人提携，事业顺利，遇事有人相助'
                    });
                }
            }
        }
    }

    // 检查桃花
    const dayBranch = bazi.day.dizhi;
    if (SHENSHA_SYSTEM.xianchi[dayBranch]) {
        for (const taohua of SHENSHA_SYSTEM.xianchi[dayBranch]) {
            if (allDizhi.includes(taohua)) {
                shenSha.push({
                    type: '桃花',
                    name: '咸池桃花',
                    location: taohua,
                    description: '桃花主感情魅力，异性缘佳',
                    effect: '感情丰富，异性缘好，但要注意感情问题'
                });
            }
        }
    }

    // 检查文昌
    for (let i = 0; i < allTiangan.length; i++) {
        const tg = allTiangan[i];
        if (SHENSHA_SYSTEM.wenchang[tg]) {
            for (const wenchang of SHENSHA_SYSTEM.wenchang[tg]) {
                if (allDizhi.includes(wenchang)) {
                    shenSha.push({
                        type: '文贵',
                        name: '文昌星',
                        location: wenchang,
                        description: '文昌主文才学业，利考试求学',
                        effect: '聪明好学，文采出众，利求学考试'
                    });
                }
            }
        }
    }

    // 检查羊刃
    for (let i = 0; i < allTiangan.length; i++) {
        const tg = allTiangan[i];
        if (SHENSHA_SYSTEM.yangren[tg]) {
            for (const yangren of SHENSHA_SYSTEM.yangren[tg]) {
                if (allDizhi.includes(yangren)) {
                    shenSha.push({
                        type: '煞星',
                        name: '羊刃',
                        location: yangren,
                        description: '羊刃性刚烈，主武职或激烈性格',
                        effect: '性格刚强，做事果断，但容易冲动，要注意脾气'
                    });
                }
            }
        }
    }

    return shenSha;
}

// 全局变量存储计算结果
let baziResult = null;

// 计算年柱
function getYearPillar(year) {
    const baseYear = 1900;
    const offset = (year - baseYear) % 60;
    const tianganIndex = offset % 10;
    const dizhiIndex = offset % 12;
    return {
        tiangan: TIANGAN[tianganIndex],
        dizhi: DIZHI[dizhiIndex],
        ganzhiStr: TIANGAN[tianganIndex] + DIZHI[dizhiIndex]
    };
}

// 计算月柱（简化版）
function getMonthPillar(year, month) {
    const yearPillar = getYearPillar(year);
    const yearTianganIndex = TIANGAN.indexOf(yearPillar.tiangan);

    // 五虎遁月
    let monthTianganStart;
    switch(yearTianganIndex) {
        case 0: case 5: monthTianganStart = 2; break;
        case 1: case 6: monthTianganStart = 4; break;
        case 2: case 7: monthTianganStart = 6; break;
        case 3: case 8: monthTianganStart = 8; break;
        case 4: case 9: monthTianganStart = 0; break;
    }

    const monthBranches = ['寅', '卯', '辰', '巳', '午', '未', '申', '酉', '戌', '亥', '子', '丑'];
    const branchIndex = (month - 2 + 12) % 12; // 调整月份索引
    const tianganIndex = (monthTianganStart + branchIndex) % 10;

    return {
        tiangan: TIANGAN[tianganIndex],
        dizhi: monthBranches[branchIndex],
        ganzhiStr: TIANGAN[tianganIndex] + monthBranches[branchIndex]
    };
}

// 计算日柱
function getDayPillar(year, month, day) {
    const baseDate = new Date(1900, 0, 1);
    const targetDate = new Date(year, month - 1, day);
    const daysDiff = Math.floor((targetDate - baseDate) / (1000 * 60 * 60 * 24));

    const baseGanzhi = 0 * 12 + 10;
    const ganzhiNum = (baseGanzhi + daysDiff) % 60;

    const tianganIndex = ganzhiNum % 10;
    const dizhiIndex = ganzhiNum % 12;

    return {
        tiangan: TIANGAN[tianganIndex],
        dizhi: DIZHI[dizhiIndex],
        ganzhiStr: TIANGAN[tianganIndex] + DIZHI[dizhiIndex]
    };
}

// 计算时柱
function getHourPillar(dayTiangan, hourIndex) {
    const dayTianganIndex = TIANGAN.indexOf(dayTiangan);

    let hourTianganStart;
    switch(dayTianganIndex % 5) {
        case 0: hourTianganStart = 0; break;
        case 1: hourTianganStart = 2; break;
        case 2: hourTianganStart = 4; break;
        case 3: hourTianganStart = 6; break;
        case 4: hourTianganStart = 8; break;
    }

    const tianganIndex = (hourTianganStart + hourIndex) % 10;

    return {
        tiangan: TIANGAN[tianganIndex],
        dizhi: SHICHEN[hourIndex],
        ganzhiStr: TIANGAN[tianganIndex] + SHICHEN[hourIndex]
    };
}

// 计算八字
function calculateBazi(year, month, day, hourIndex) {
    const yearPillar = getYearPillar(year);
    const monthPillar = getMonthPillar(year, month);
    const dayPillar = getDayPillar(year, month, day);
    const hourPillar = getHourPillar(dayPillar.tiangan, hourIndex);

    return {
        year: yearPillar,
        month: monthPillar,
        day: dayPillar,
        hour: hourPillar
    };
}

// 五行统计
function analyzeWuxing(bazi) {
    const wuxingCount = { '木': 0, '火': 0, '土': 0, '金': 0, '水': 0 };

    [bazi.year.tiangan, bazi.month.tiangan, bazi.day.tiangan, bazi.hour.tiangan].forEach(tg => {
        wuxingCount[TIANGAN_WUXING[tg]]++;
    });

    [bazi.year.dizhi, bazi.month.dizhi, bazi.day.dizhi, bazi.hour.dizhi].forEach(dz => {
        wuxingCount[DIZHI_WUXING[dz]]++;
    });

    return wuxingCount;
}

// 五行分析文字
function getWuxingAnalysisText(wuxingCount) {
    let analysis = '';
    const sortedWuxing = Object.entries(wuxingCount).sort((a, b) => b[1] - a[1]);
    const strongest = sortedWuxing[0][0];
    const weakest = sortedWuxing[sortedWuxing.length - 1][0];

    analysis += `您的五行以${strongest}最旺，共有${sortedWuxing[0][1]}个；`;

    if (sortedWuxing[sortedWuxing.length - 1][1] === 0) {
        analysis += `缺${weakest}。`;
    } else {
        analysis += `${weakest}最弱，仅有${sortedWuxing[sortedWuxing.length - 1][1]}个。`;
    }

    analysis += '\n\n';

    if (sortedWuxing[0][1] >= 4) {
        const keElement = WUXING_SHENGKE[strongest].keBy;
        analysis += `五行${strongest}过旺，容易导致能量失衡。建议在生活中多接触${keElement}元素，以达到五行平衡。`;
    } else if (sortedWuxing[sortedWuxing.length - 1][1] === 0) {
        const shengElement = WUXING_SHENGKE[weakest].shengBy;
        analysis += `五行缺${weakest}，建议通过${shengElement}来生${weakest}，可以弥补${weakest}的不足。`;
    } else {
        analysis += '您的五行相对平衡，这是很好的命理格局，有利于各方面发展。';
    }

    return analysis;
}

// 计算大运
function calculateDayun(bazi, gender, birthYear) {
    const dayunList = [];
    const yearGan = TIANGAN.indexOf(bazi.year.tiangan);
    const monthGan = TIANGAN.indexOf(bazi.month.tiangan);
    const monthZhi = DIZHI.indexOf(bazi.month.dizhi);

    const isYangYear = yearGan % 2 === 0;
    const isMale = (gender === 'male');
    const isShunxing = (isYangYear && isMale) || (!isYangYear && !isMale);

    let startAge = 8;

    for (let i = 0; i < 10; i++) {
        let ganIndex, zhiIndex;

        if (isShunxing) {
            ganIndex = (monthGan + i + 1) % 10;
            zhiIndex = (monthZhi + i + 1) % 12;
        } else {
            ganIndex = (monthGan - i - 1 + 10) % 10;
            zhiIndex = (monthZhi - i - 1 + 12) % 12;
        }

        const age = startAge + i * 10;
        const yearRange = `${birthYear + age}年-${birthYear + age + 9}年`;
        const ageRange = `${age}岁-${age + 9}岁`;

        dayunList.push({
            ganzhi: TIANGAN[ganIndex] + DIZHI[zhiIndex],
            tiangan: TIANGAN[ganIndex],
            dizhi: DIZHI[zhiIndex],
            yearRange: yearRange,
            ageRange: ageRange,
            description: getDayunDescription(TIANGAN[ganIndex], DIZHI[zhiIndex], bazi)
        });
    }

    return dayunList;
}

// 大运描述
function getDayunDescription(tiangan, dizhi, bazi) {
    const dayTiangan = bazi.day.tiangan;
    const wuxing = TIANGAN_WUXING[tiangan];
    const dayWuxing = TIANGAN_WUXING[dayTiangan];

    let desc = '';

    if (wuxing === dayWuxing) {
        desc = '比肩劫财运，朋友助力，竞争增加，适合合作发展。';
    } else if (WUXING_SHENGKE[dayWuxing].sheng === wuxing) {
        desc = '食伤运，表达力强，创意发挥，利于艺术创作和展示才华。';
    } else if (WUXING_SHENGKE[dayWuxing].ke === wuxing) {
        desc = '财运旺盛，求财顺利，事业发展，把握机会可获丰厚回报。';
    } else if (WUXING_SHENGKE[dayWuxing].keBy === wuxing) {
        desc = '官杀运，责任增加，易遇贵人，事业上可能有晋升机会。';
    } else if (WUXING_SHENGKE[dayWuxing].shengBy === wuxing) {
        desc = '印绶运，学习运佳，贵人相助，适合深造和提升自我。';
    }

    return desc;
}

// 计算流年
function calculateLiunian(currentYear) {
    const liunianList = [];

    for (let i = -2; i <= 7; i++) {
        const year = currentYear + i;
        const yearPillar = getYearPillar(year);

        liunianList.push({
            year: year,
            ganzhi: yearPillar.ganzhiStr,
            tiangan: yearPillar.tiangan,
            dizhi: yearPillar.dizhi,
            description: getLiunianDescription(yearPillar.tiangan, yearPillar.dizhi, i === 0)
        });
    }

    return liunianList;
}

// 流年描述
function getLiunianDescription(tiangan, dizhi, isCurrent) {
    const wuxing = TIANGAN_WUXING[tiangan];
    const descriptions = {
        '木': '生发之年，适合开创新事业，人际关系和谐',
        '火': '热情活跃，事业有突破，注意情绪管理',
        '土': '稳重务实，适合积累和沉淀，财运平稳',
        '金': '决断力强，适合改革创新，注意人际关系',
        '水': '智慧灵动，学习运佳，适合规划未来'
    };

    return isCurrent ? `【本年】${descriptions[wuxing]}` : descriptions[wuxing];
}

// 简化的性格分析
function analyzePersonality(bazi, wuxingCount) {
    const dayTiangan = bazi.day.tiangan;
    const dayWuxing = TIANGAN_WUXING[dayTiangan];
    const sortedWuxing = Object.entries(wuxingCount).sort((a, b) => b[1] - a[1]);
    const strongestWuxing = sortedWuxing[0][0];

    let personality = `【日主特质】您的日主为${dayTiangan}${dayWuxing}，`;

    const ganPersonality = {
        '甲': '正直坦荡，有强烈的进取心和领导力',
        '乙': '温和柔韧，富有艺术气质和适应能力',
        '丙': '热情开朗，充满正能量和感染力',
        '丁': '细腻敏感，富有洞察力和艺术气质',
        '戊': '稳重厚实，包容性强，值得依靠',
        '己': '细心谨慎，善于筹划，注重细节',
        '庚': '刚毅果断，有很强的执行力和原则性',
        '辛': '精致细腻，追求完美，品味高雅',
        '壬': '智慧灵活，适应力强，善于变通',
        '癸': '温柔内敛，心思细密，有包容心'
    };

    personality += ganPersonality[dayTiangan] + '。\n\n';

    if (strongestWuxing === '木' && wuxingCount['木'] >= 3) {
        personality += `【五行性格】命中木旺，仁爱之心强，富有同情心和正义感。上进心强，不甘平庸，有远大抱负。但需注意不要过于执拗，学会变通。`;
    } else if (strongestWuxing === '火' && wuxingCount['火'] >= 3) {
        personality += `【五行性格】命中火旺，热情洋溢，活力四射，具有很强的感染力。做事积极主动，不拖泥带水。但要注意控制脾气，避免冲动行事。`;
    } else if (strongestWuxing === '土' && wuxingCount['土'] >= 3) {
        personality += `【五行性格】命中土旺，诚实守信，稳重踏实，值得信赖。有很强的耐心和包容心，能承担重任。但要注意不要过于保守，适当接受新事物。`;
    } else if (strongestWuxing === '金' && wuxingCount['金'] >= 3) {
        personality += `【五行性格】命中金旺，果断坚毅，讲原则重信义。做事干脆利落，不拖泥带水。但要注意圆融变通，不要过于刚硬。`;
    } else if (strongestWuxing === '水' && wuxingCount['水'] >= 3) {
        personality += `【五行性格】命中水旺，聪明机智，灵活多变，善于应对各种情况。思维活跃，点子多。但要注意意志坚定，不要朝三暮四。`;
    } else {
        personality += `【五行性格】五行相对平衡，性格较为全面，适应能力强。既有原则性又有灵活性，能够在不同环境中游刃有余。`;
    }

    return personality;
}

// 简化的事业分析
function analyzeCareer(bazi, wuxingCount) {
    const dayTiangan = bazi.day.tiangan;
    const dayWuxing = TIANGAN_WUXING[dayTiangan];

    let career = `【事业方向】您的日主五行属${dayWuxing}，`;

    const careerGuidance = {
        '木': '适合文化教育、出版传媒、环保绿化、医药保健等行业',
        '火': '适合能源电力、电子科技、餐饮酒店、娱乐影视等行业',
        '土': '适合房地产、建筑工程、农林牧业、中介咨询等行业',
        '金': '适合金融证券、科技制造、机械五金、军警法律等行业',
        '水': '适合贸易流通、物流运输、旅游酒店、信息技术等行业'
    };

    career += careerGuidance[dayWuxing] + '。\n\n';

    career += `【发展建议】建议发挥您的${dayWuxing}性特质，在相关领域深耕细作。保持学习的热情，不断提升专业能力，同时注意人际关系的维护。`;

    return career;
}

// 简化的财运分析
function analyzeWealth(bazi, wuxingCount) {
    const dayTiangan = bazi.day.tiangan;
    const dayWuxing = TIANGAN_WUXING[dayTiangan];
    const caiWuxing = WUXING_SHENGKE[dayWuxing].ke;
    const caiCount = wuxingCount[caiWuxing];

    let wealth = `【财星状况】您的财星为${caiWuxing}，命中有${caiCount}个${caiWuxing}。\n\n`;

    if (caiCount === 0) {
        wealth += `【财运特点】命中财星较弱，财富主要来自于勤奋工作和稳健经营。建议脚踏实地，通过正当职业积累财富，避免投机冒险。`;
    } else if (caiCount === 1) {
        wealth += `【财运特点】命中财星适中，财运平稳。细水长流型，不会暴富但也不会缺钱。建议稳健理财，中长期投资规划。`;
    } else if (caiCount === 2) {
        wealth += `【财运特点】命中财星旺盛，财运较好。有多种获取财富的机会，善于发现商机。建议控制风险，专注经营。`;
    } else {
        wealth += `【财运特点】命中财星过旺，财多身弱。虽然财运机会很多，但要注意平衡，避免为了赚钱透支身体。`;
    }

    return wealth;
}

// 简化的婚姻分析
function analyzeMarriage(bazi, wuxingCount, gender) {
    const dayTiangan = bazi.day.tiangan;
    const dayWuxing = TIANGAN_WUXING[dayTiangan];

    let spouseWuxing, spouseLabel;
    if (gender === 'male') {
        spouseWuxing = WUXING_SHENGKE[dayWuxing].ke;
        spouseLabel = '财星';
    } else {
        spouseWuxing = WUXING_SHENGKE[dayWuxing].keBy;
        spouseLabel = '官星';
    }

    const spouseCount = wuxingCount[spouseWuxing];

    let marriage = `【配偶星】您的${spouseLabel}为${spouseWuxing}，命中有${spouseCount}个${spouseWuxing}。\n\n`;

    if (spouseCount === 0) {
        marriage += `【姻缘分析】${spouseLabel}较弱，姻缘可能来得较晚。对感情较为谨慎，这是负责任的表现。建议主动扩大社交圈，多参加各类活动。`;
    } else if (spouseCount === 1) {
        marriage += `【姻缘分析】${spouseLabel}适中，婚姻运势较好。容易遇到合适的伴侣，婚后感情稳定和谐。建议珍惜缘分，用心经营感情。`;
    } else if (spouseCount === 2) {
        marriage += `【姻缘分析】${spouseLabel}旺盛，异性缘佳，桃花运好。容易吸引异性关注。建议把握分寸，避免感情纠葛。`;
    } else {
        marriage += `【姻缘分析】${spouseLabel}过旺，桃花过多，感情容易复杂。魅力强，异性缘极佳。需要特别注意分辨真爱与虚情。`;
    }

    return marriage;
}

// 简化的健康分析
function analyzeHealth(bazi, wuxingCount) {
    const sortedWuxing = Object.entries(wuxingCount).sort((a, b) => b[1] - a[1]);
    const strongestWuxing = sortedWuxing[0][0];
    const weakestWuxing = sortedWuxing[sortedWuxing.length - 1][0];

    let health = `【健康状况】`;

    if (sortedWuxing[0][1] >= 4) {
        health += `五行${strongestWuxing}过旺，需要特别关注相关健康问题。建议保持良好作息，均衡饮食，适度运动。`;
    } else if (sortedWuxing[sortedWuxing.length - 1][1] === 0) {
        health += `五行缺${weakestWuxing}，相关身体系统相对较弱。建议通过后天调理来改善体质，预防胜于治疗。`;
    } else {
        health += `您的五行相对平衡，这是非常好的体质基础。保持健康生活方式，定期体检。`;
    }

    return health;
}

// 简化的用神分析
function findYongShen(bazi, wuxingCount) {
    const dayTiangan = bazi.day.tiangan;
    const dayWuxing = TIANGAN_WUXING[dayTiangan];
    const sortedWuxing = Object.entries(wuxingCount).sort((a, b) => b[1] - a[1]);

    let primary = '';

    // 如果某个五行缺失，优先补充
    for (const [wx, count] of sortedWuxing) {
        if (count === 0) {
            primary = wx;
            break;
        }
    }

    // 如果没有缺失，选择最弱的
    if (!primary && sortedWuxing.length > 0) {
        primary = sortedWuxing[sortedWuxing.length - 1][0];
    }

    return {
        primary: primary || '土',
        secondary: '',
        reasoning: `根据您的八字五行分布，建议以${primary || '土'}为主要用神来调和命局。`,
        advice: `用神为${primary || '土'}。在日常生活中，可以多接触与用神五行相关的事物，如颜色、方位、职业等，有助于运势提升。`
    };
}

// 简化的格局分析
function analyzeGeju(bazi) {
    return [{
        name: '普通格局',
        key: 'normal',
        quality: '正格',
        description: '您的八字格局较为平衡，无特殊格局。',
        characteristics: '性格平和，运势稳定，适合稳步发展。',
        strength: '中'
    }];
}

// 显示结果
function displayResults(bazi, wuxingCount, dayunList, liunianList, gender, nameWuxingData) {
    // 显示八字
    document.getElementById('yearPillar').textContent = bazi.year.ganzhiStr;
    document.getElementById('monthPillar').textContent = bazi.month.ganzhiStr;
    document.getElementById('dayPillar').textContent = bazi.day.ganzhiStr;
    document.getElementById('hourPillar').textContent = bazi.hour.ganzhiStr;

    // 八字详情
    const baziDetails = `
        <p><strong>日主：</strong>${bazi.day.tiangan}（${TIANGAN_WUXING[bazi.day.tiangan]}）</p>
        <p><strong>命格：</strong>${bazi.day.tiangan}${DIZHI_WUXING[bazi.day.dizhi]}日元</p>
    `;
    document.getElementById('baziDetails').innerHTML = baziDetails;

    // 显示五行图表
    const wuxingChart = document.getElementById('wuxingChart');
    wuxingChart.innerHTML = '';
    const maxCount = Math.max(...Object.values(wuxingCount));

    ['木', '火', '土', '金', '水'].forEach(wx => {
        const percentage = maxCount > 0 ? (wuxingCount[wx] / maxCount) * 100 : 0;
        const colorClass = { '木': 'wood', '火': 'fire', '土': 'earth', '金': 'metal', '水': 'water' }[wx];

        wuxingChart.innerHTML += `
            <div class="wuxing-item ${colorClass}">
                <div class="wuxing-name">${wx}</div>
                <div class="wuxing-count">${wuxingCount[wx]}</div>
                <div class="wuxing-bar">
                    <div class="wuxing-bar-fill" style="width: ${percentage}%"></div>
                </div>
            </div>
        `;
    });

    // 五行分析文字
    document.getElementById('wuxingAnalysis').innerHTML = `
        <h3>五行平衡分析</h3>
        <p>${getWuxingAnalysisText(wuxingCount)}</p>
    `;

    // 显示大运
    const dayunListEl = document.getElementById('dayunList');
    dayunListEl.innerHTML = '';
    dayunList.forEach(dy => {
        dayunListEl.innerHTML += `
            <div class="dayun-item">
                <h3>${dy.ageRange}</h3>
                <div class="dayun-pillar">${dy.ganzhi}</div>
                <div class="dayun-age">${dy.yearRange}</div>
                <div class="dayun-desc">${dy.description}</div>
            </div>
        `;
    });

    // 显示流年
    const liunianListEl = document.getElementById('liunianList');
    liunianListEl.innerHTML = '';
    liunianList.forEach(ln => {
        liunianListEl.innerHTML += `
            <div class="liunian-item">
                <div class="liunian-year">${ln.year}年</div>
                <div class="liunian-pillar">${ln.ganzhi}</div>
                <div class="liunian-desc">${ln.description}</div>
            </div>
        `;
    });

    // 显示高级命理分析
    displayAdvancedAnalysis(bazi, wuxingCount);

    // 显示命理分析
    displayFormattedAnalysis('personalityAnalysis', analyzePersonality(bazi, wuxingCount));
    displayFormattedAnalysis('careerAnalysis', analyzeCareer(bazi, wuxingCount));
    displayFormattedAnalysis('wealthAnalysis', analyzeWealth(bazi, wuxingCount));
    displayFormattedAnalysis('marriageAnalysis', analyzeMarriage(bazi, wuxingCount, gender));
    displayFormattedAnalysis('healthAnalysis', analyzeHealth(bazi, wuxingCount));

    // 显示结果区域
    document.querySelector('.input-section').style.display = 'none';
    document.getElementById('results').style.display = 'block';

    // 显示大师印章
    document.getElementById('masterSeal').style.display = 'flex';
}

// 格式化显示命理分析
function displayFormattedAnalysis(elementId, analysisText) {
    const element = document.getElementById(elementId);
    if (!element) return;

    const formattedText = analysisText
        .replace(/【([^】]+)】/g, '<div class="analysis-section-title">【$1】</div>')
        .replace(/\n\n/g, '</div><div class="analysis-paragraph">')
        .replace(/\n/g, '<br>');

    element.innerHTML = `
        <div class="analysis-content">
            <div class="analysis-paragraph">${formattedText}</div>
        </div>
    `;
}

// 显示高级命理分析
function displayAdvancedAnalysis(bazi, wuxingCount) {
    // 用神分析
    const yongshenAnalysis = findYongShen(bazi, wuxingCount);
    document.getElementById('yongshenAnalysis').innerHTML = `
        <div class="yongshen-container">
            <h4 class="analysis-title">用神判断</h4>
            <div class="analysis-section">
                <h5 class="section-subtitle">命局分析</h5>
                <p class="analysis-text">${yongshenAnalysis.reasoning}</p>
            </div>
            <div class="yongshen-results">
                <div class="yongshen-item">
                    <span class="yongshen-label">主用神：</span>
                    <span class="yongshen-primary">${yongshenAnalysis.primary}</span>
                </div>
            </div>
            <div class="analysis-section">
                <h5 class="section-subtitle">用神建议</h5>
                <p class="analysis-text">${yongshenAnalysis.advice}</p>
            </div>
        </div>
    `;

    // 格局分析
    const gejuAnalysis = analyzeGeju(bazi);
    let gejuHTML = `
    <div class="geju-container">
        <h4 class="analysis-title">格局判断</h4>
        <div class="geju-results">`;

    gejuAnalysis.forEach(geju => {
        gejuHTML += `
            <div class="geju-item">
                <div class="geju-header">
                    <h5 class="geju-name">${geju.name}</h5>
                    <span class="geju-quality ${geju.quality}">${geju.quality}</span>
                </div>
                <div class="geju-details">
                    <div class="geju-detail-item">
                        <span class="detail-label">格局特点：</span>
                        <span class="detail-text">${geju.description}</span>
                    </div>
                    <div class="geju-detail-item">
                        <span class="detail-label">性格特征：</span>
                        <span class="detail-text">${geju.characteristics}</span>
                    </div>
                </div>
            </div>
        `;
    });

    gejuHTML += `</div></div>`;
    document.getElementById('gejuAnalysis').innerHTML = gejuHTML;

    // 神煞分析
    const shenshaAnalysis = analyzeShenSha(bazi);
    let shenshaHTML = `
    <div class="shensha-container">
        <h4 class="analysis-title">神煞星宿</h4>`;

    if (shenshaAnalysis.length > 0) {
        shenshaHTML += '<div class="shensha-grid">';

        const typeOrder = ['贵人', '文贵', '桃花', '煞星'];
        const sortedShensha = [];

        typeOrder.forEach(type => {
            const typeShensha = shenshaAnalysis.filter(s => s.type === type);
            sortedShensha.push(...typeShensha);
        });

        sortedShensha.forEach(shensha => {
            let itemClass = 'shensha-item';
            if (shensha.type === '贵人' || shensha.type === '文贵') {
                itemClass += ' auspicious';
            } else if (shensha.type === '桃花') {
                itemClass += ' neutral';
            } else if (shensha.type === '煞星') {
                itemClass += ' inauspicious';
            }

            shenshaHTML += `
                <div class="${itemClass}">
                    <div class="shensha-header">
                        <div class="shensha-name">${shensha.name}</div>
                        <div class="shensha-type">${shensha.type}</div>
                    </div>
                    <div class="shensha-content">
                        <p class="shensha-description">${shensha.description}</p>
                        <p class="shensha-effect">${shensha.effect}</p>
                    </div>
                </div>
            `;
        });

        shenshaHTML += '</div>';
    } else {
        shenshaHTML += `
            <div class="shensha-empty">
                <p class="empty-text">您的八字中神煞较少，命局相对清纯。</p>
            </div>
        `;
    }

    shenshaHTML += `</div>`;
    document.getElementById('shenshaAnalysis').innerHTML = shenshaHTML;
}

// 重置表单
function resetForm() {
    document.querySelector('.input-section').style.display = 'block';
    document.getElementById('results').style.display = 'none';
    document.getElementById('birthdayForm').reset();
    window.scrollTo({ top: 0, behavior: 'smooth' });
}

// 历法切换监听
document.addEventListener('DOMContentLoaded', function() {
    const calendarTypeInputs = document.querySelectorAll('input[name="calendarType"]');
    const leapMonthGroup = document.getElementById('leapMonthGroup');

    calendarTypeInputs.forEach(input => {
        input.addEventListener('change', function() {
            if (this.value === 'lunar') {
                leapMonthGroup.style.display = 'block';
            } else {
                leapMonthGroup.style.display = 'none';
                document.getElementById('isLeapMonth').checked = false;
            }
        });
    });
});

// 表单提交处理
document.getElementById('birthdayForm').addEventListener('submit', function(e) {
    e.preventDefault();

    const name = document.getElementById('name').value.trim();
    const birthdateInput = document.getElementById('birthdate').value;
    const calendarType = document.querySelector('input[name="calendarType"]:checked').value;
    const isLeapMonth = document.getElementById('isLeapMonth').checked;
    const hourIndex = parseInt(document.getElementById('hour').value);
    const gender = document.getElementById('gender').value;

    if (!birthdateInput) {
        alert('请选择出生日期！');
        return;
    }

    // 解析日期
    const dateParts = birthdateInput.split('-');
    let year = parseInt(dateParts[0]);
    let month = parseInt(dateParts[1]);
    let day = parseInt(dateParts[2]);

    // 如果是农历，转换为阳历
    if (calendarType === 'lunar') {
        const solarDate = lunar2solar(year, month, day, isLeapMonth);
        if (!solarDate) {
            alert('农历日期转换失败，请检查日期是否正确！');
            return;
        }
        year = solarDate.year;
        month = solarDate.month;
        day = solarDate.day;
    }

    // 验证日期
    const date = new Date(year, month - 1, day);
    if (date.getMonth() + 1 !== month || date.getDate() !== day) {
        alert('请输入有效的日期！');
        return;
    }

    // 计算八字
    const bazi = calculateBazi(year, month, day, hourIndex);
    baziResult = bazi;

    // 分析五行
    const wuxingCount = analyzeWuxing(bazi);

    // 计算大运
    const dayunList = calculateDayun(bazi, gender, year);

    // 计算流年
    const currentYear = new Date().getFullYear();
    const liunianList = calculateLiunian(currentYear);

    // 显示结果
    displayResults(bazi, wuxingCount, dayunList, liunianList, gender, null);

    // 滚动到结果区域
    window.scrollTo({ top: 0, behavior: 'smooth' });
});
    </script>
</body>
</html>